<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Sticker Pack Game</title>

<style>
  :root {
    --primary-color: #4a6fa5;
    --secondary-color: #ff6b6b;
    --accent-color: #32cd32;
    --dark-color: #333;
    --light-color: #f5f5f5;
    --card-width: 140px;
    --card-height: 210px;
  }

  * {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
  }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    overflow-x: hidden;
  }

  .game-container {
    width: 100%;
    max-width: 1200px;
    padding: 10px;
  }

  header {
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    padding: 12px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-radius: 20px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    margin-bottom: 15px;
    flex-wrap: wrap;
    gap: 10px;
    backdrop-filter: blur(10px);
  }

  .header-left, .header-right {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .header-btn {
    font-size: 14px;
    padding: 8px 12px;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 5px;
    min-height: 36px;
  }

  .header-btn:active {
    transform: scale(0.95);
  }

  .stats {
    display: flex;
    gap: 15px;
    font-weight: bold;
    font-size: 14px;
    color: var(--dark-color);
    background: rgba(255, 255, 255, 0.9);
    padding: 8px 15px;
    border-radius: 10px;
    align-items: center;
  }

  .stats span {
    display: flex;
    align-items: center;
    gap: 5px;
  }

  #sticker-area {
    width: 100%;
    height: 50vh;
    min-height: 300px;
    max-height: 400px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 20px;
    position: relative;
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    margin-bottom: 20px;
    border: 2px solid rgba(255, 255, 255, 0.2);
  }

  .sticker-card {
    width: var(--card-width);
    height: var(--card-height);
    border: 2px solid var(--dark-color);
    background: white;
    position: absolute;
    transform-style: preserve-3d;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1), left 0.8s ease-out, top 0.8s ease-out;
    user-select: none;
    cursor: pointer;
    box-shadow: 0 10px 20px rgba(0,0,0,0.15);
    border-radius: 15px;
    touch-action: none;
    z-index: 1;
  }

  .sticker-card.flipped {
    transform: rotateY(180deg) !important;
  }

  .sticker-card:active {
    z-index: 100;
  }

  .sticker-front, .sticker-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 13px;
    overflow: hidden;
  }

  .sticker-front {
    background: linear-gradient(45deg, var(--secondary-color), #ffa500);
    color: white;
    font-size: 48px;
    font-weight: bold;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
  }

  .sticker-back {
    transform: rotateY(180deg);
    flex-direction: column;
    background: linear-gradient(135deg, #ffffff, #f8f9fa);
    padding: 10px;
  }

  .sticker-back img {
    width: 100%;
    height: 140px;
    object-fit: contain;
    margin-bottom: 10px;
    pointer-events: none;
  }

  .sticker-number {
    font-size: 14px;
    font-weight: bold;
    color: var(--dark-color);
    background: rgba(255, 255, 255, 0.9);
    padding: 4px 12px;
    border-radius: 20px;
  }

  #open-pack {
    width: 90%;
    max-width: 300px;
    padding: 16px 24px;
    font-size: 18px;
    background: linear-gradient(45deg, var(--accent-color), #28a745);
    color: white;
    border: none;
    border-radius: 15px;
    cursor: pointer;
    font-weight: bold;
    box-shadow: 0 6px 0 rgba(40, 167, 69, 0.3);
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin: 0 auto 20px;
  }

  #open-pack:active {
    transform: translateY(4px);
    box-shadow: 0 2px 0 rgba(40, 167, 69, 0.3);
  }

  #open-pack.disabled {
    background: linear-gradient(45deg, #dc3545, #c82333);
    box-shadow: 0 6px 0 rgba(220, 53, 69, 0.3);
    cursor: not-allowed;
    opacity: 0.7;
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 1000;
    padding: 20px;
    overflow-y: auto;
  }

  .modal-content {
    background: white;
    border-radius: 25px;
    padding: 25px;
    max-width: 800px;
    margin: 30px auto;
    position: relative;
    animation: modalSlideIn 0.3s ease-out;
    max-height: 85vh;
    overflow-y: auto;
  }

  @keyframes modalSlideIn {
    from {
      opacity: 0;
      transform: translateY(-30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 2px solid var(--light-color);
  }

  .modal-title {
    font-size: 24px;
    font-weight: bold;
    color: var(--primary-color);
    margin: 0;
  }

  .close-btn {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--light-color);
    border: none;
    font-size: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
  }

  .close-btn:active {
    background: var(--secondary-color);
    color: white;
  }

  .grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 12px;
    margin-top: 20px;
  }

  .slot {
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 15px;
    aspect-ratio: 2/3;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    padding: 10px;
    transition: all 0.3s;
    border: 2px dashed #adb5bd;
  }

  .slot.has-sticker {
    background: linear-gradient(135deg, #ffffff, #f8f9fa);
    border: 2px solid var(--primary-color);
    box-shadow: 0 4px 8px rgba(74, 111, 165, 0.2);
  }

  .slot img {
    width: 100%;
    height: 70px;
    object-fit: contain;
    margin-bottom: 8px;
    pointer-events: none;
  }

  .slot-number {
    font-size: 12px;
    font-weight: bold;
    color: var(--dark-color);
    background: rgba(255, 255, 255, 0.9);
    padding: 2px 8px;
    border-radius: 10px;
  }

  .slot.empty {
    color: #adb5bd;
    font-size: 32px;
    font-weight: bold;
  }

  .sell-btn {
    width: 100%;
    padding: 15px;
    background: linear-gradient(45deg, #ffc107, #fd7e14);
    color: white;
    border: none;
    border-radius: 15px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin-top: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    transition: all 0.3s;
  }

  .sell-btn:active {
    transform: scale(0.98);
  }

  /* Mobile-specific adjustments */
  @media (max-width: 768px) {
    :root {
      --card-width: 120px;
      --card-height: 180px;
    }

    .game-container {
      padding: 8px;
    }

    header {
      padding: 10px;
      flex-direction: column;
      gap: 8px;
    }

    .header-left, .header-right {
      width: 100%;
      justify-content: space-around;
    }

    .header-btn {
      font-size: 12px;
      padding: 6px 10px;
      flex: 1;
      justify-content: center;
    }

    .stats {
      width: 100%;
      justify-content: center;
      font-size: 12px;
    }

    #sticker-area {
      height: 45vh;
      min-height: 250px;
    }

    .sticker-back img {
      height: 110px;
    }

    .sticker-number {
      font-size: 12px;
    }

    .grid {
      grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
      gap: 8px;
    }

    .slot {
      aspect-ratio: 3/4;
    }

    .slot img {
      height: 60px;
    }

    .modal-content {
      margin: 10px;
      padding: 20px;
    }

    .modal-title {
      font-size: 20px;
    }
  }

  @media (max-width: 480px) {
    :root {
      --card-width: 100px;
      --card-height: 150px;
    }

    .header-btn {
      font-size: 11px;
      padding: 5px 8px;
    }

    .stats {
      font-size: 11px;
    }

    #sticker-area {
      height: 40vh;
      min-height: 200px;
    }

    .sticker-front {
      font-size: 36px;
    }

    .sticker-back img {
      height: 90px;
    }

    .grid {
      grid-template-columns: repeat(auto-fill, minmax(70px, 1fr));
      gap: 6px;
    }

    .slot img {
      height: 50px;
    }

    #open-pack {
      font-size: 16px;
      padding: 14px 20px;
    }
  }

  /* Toast notifications */
  .toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    font-weight: 500;
    z-index: 1001;
    animation: toastSlideUp 0.3s ease-out;
    backdrop-filter: blur(10px);
    max-width: 90%;
    text-align: center;
  }

  @keyframes toastSlideUp {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  /* Swipe indicator for mobile */
  .swipe-indicator {
    position: absolute;
    bottom: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: rgba(0, 0, 0, 0.5);
    font-size: 12px;
    display: flex;
    align-items: center;
    gap: 5px;
    background: rgba(255, 255, 255, 0.7);
    padding: 4px 12px;
    border-radius: 15px;
  }

  .swipe-indicator span {
    animation: swipePulse 2s infinite;
  }

  @keyframes swipePulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
  }
</style>
</head>

<body>
<div class="game-container">
  <header>
    <div class="header-left">
      <button class="header-btn" id="album-btn">üìñ Album</button>
      <button class="header-btn" id="duplicates-btn">üìÇ Duplicates</button>
    </div>
    <div class="header-right">
      <button class="header-btn" id="save-btn">üíæ Save</button>
      <button class="header-btn" id="reset-btn">üîÑ Reset</button>
    </div>
    <div class="stats">
      <span id="coins">üí∞ Coins: 100</span>
      <span id="packs">üì¶ Packs: 0</span>
    </div>
  </header>

  <div id="sticker-area">
    <div class="swipe-indicator">
      <span>üëÜ</span> Tap to flip ‚Ä¢ Drag to move
    </div>
  </div>

  <button id="open-pack">üéÅ OPEN PACK (5 Coins)</button>

  <!-- Album Modal -->
  <div class="modal" id="album-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Sticker Album</h2>
        <button class="close-btn" onclick="closeModal('album-modal')">‚úñ</button>
      </div>
      <div class="grid" id="album-grid"></div>
    </div>
  </div>

  <!-- Duplicates Modal -->
  <div class="modal" id="duplicates-modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">Duplicates</h2>
        <button class="close-btn" onclick="closeModal('duplicates-modal')">‚úñ</button>
      </div>
      <div class="grid" id="duplicates-grid"></div>
      <button class="sell-btn" id="sell-duplicates">
        üí∞ Sell All Duplicates (<span id="duplicate-count">0</span>)
      </button>
    </div>
  </div>
</div>

<script>
const STICKERS_TOTAL = 700;
let coins = 100;
let packsOpened = 0;
const userCollection = [];
const duplicates = [];

const stickerArea = document.getElementById('sticker-area');
const coinsLabel = document.getElementById('coins');
const packsLabel = document.getElementById('packs');
const openPackBtn = document.getElementById('open-pack');
const duplicateCount = document.getElementById('duplicate-count');

// Touch and drag functionality
let activeCard = null;
let startX = 0, startY = 0, initialLeft = 0, initialTop = 0;

function setupTouchEvents(card) {
  card.addEventListener('touchstart', handleTouchStart, { passive: false });
  card.addEventListener('touchmove', handleTouchMove, { passive: false });
  card.addEventListener('touchend', handleTouchEnd);
}

function handleTouchStart(e) {
  if (e.target.closest('.sticker-card')) {
    activeCard = e.target.closest('.sticker-card');
    const touch = e.touches[0];
    startX = touch.clientX;
    startY = touch.clientY;
    initialLeft = parseFloat(activeCard.style.left) || 0;
    initialTop = parseFloat(activeCard.style.top) || 0;
    e.preventDefault();
  }
}

function handleTouchMove(e) {
  if (!activeCard) return;
  
  const touch = e.touches[0];
  const deltaX = touch.clientX - startX;
  const deltaY = touch.clientY - startY;
  
  const newLeft = Math.max(0, Math.min(stickerArea.offsetWidth - activeCard.offsetWidth, initialLeft + deltaX));
  const newTop = Math.max(0, Math.min(stickerArea.offsetHeight - activeCard.offsetHeight, initialTop + deltaY));
  
  activeCard.style.left = `${newLeft}px`;
  activeCard.style.top = `${newTop}px`;
  e.preventDefault();
}

function handleTouchEnd() {
  if (activeCard) {
    saveGame();
    activeCard = null;
  }
}

function showToast(message) {
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = message;
  document.body.appendChild(toast);
  
  setTimeout(() => {
    toast.remove();
  }, 2000);
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = 'none';
}

function saveGame() {
  const data = {
    coins,
    packsOpened,
    userCollection: [...userCollection],
    duplicates: [...duplicates]
  };
  localStorage.setItem("stickerGameSave", JSON.stringify(data));
  showToast('Game saved!');
}

function resetGame() {
  if (confirm("Are you sure you want to reset your account? You'll lose all progress!")) {
    coins = 100;
    packsOpened = 0;
    userCollection.length = 0;
    duplicates.length = 0;
    localStorage.removeItem("stickerGameSave");
    updateLabels();
    stickerArea.innerHTML = '';
    showToast('Game reset to default');
  }
}

function updateLabels() {
  coinsLabel.textContent = `üí∞ Coins: ${coins}`;
  packsLabel.textContent = `üì¶ Packs: ${packsOpened}`;
  duplicateCount.textContent = duplicates.length;
  openPackBtn.classList.toggle('disabled', coins < 5);
}

function getRandomStickers(count) {
  const nums = Array.from({length: STICKERS_TOTAL}, (_, i) => i + 1);
  for (let i = nums.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [nums[i], nums[j]] = [nums[j], nums[i]];
  }
  return nums.slice(0, count);
}

function openPack() {
  if (coins < 5) {
    showToast('Not enough coins!');
    return;
  }

  coins -= 5;
  packsOpened++;
  updateLabels();

  stickerArea.innerHTML = '';
  const stickers = getRandomStickers(5);

  // Center position for the stack
  const centerX = stickerArea.offsetWidth / 2 - parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--card-width')) / 2;
  const centerY = stickerArea.offsetHeight / 2 - parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--card-height')) / 2;

  stickers.forEach((num, i) => {
    const card = document.createElement('div');
    card.className = 'sticker-card';
    card.dataset.number = num;
    
    // Start all cards stacked in the center
    card.style.left = `${centerX + i * 2}px`;
    card.style.top = `${centerY + i * 2}px`;

    const img = document.createElement('img');
    img.src = `images/${num}.png`;
    img.alt = `Sticker #${num}`;
    
    img.onerror = function() {
      // If image fails to load, show number in a nice way
      this.style.display = 'none';
      const container = this.parentElement;
      const numberDiv = document.createElement('div');
      numberDiv.style.cssText = `
        font-size: 36px;
        color: #4a6fa5;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
      `;
      numberDiv.textContent = `#${num}`;
      container.appendChild(numberDiv);
    };

    card.innerHTML = `
      <div class="sticker-front">?</div>
      <div class="sticker-back">
        <div class="sticker-img"></div>
        <div class="sticker-number">#${num}</div>
      </div>
    `;

    // Add the image
    const imgContainer = card.querySelector('.sticker-img');
    imgContainer.appendChild(img);

    // Add click/touch events
    card.addEventListener('click', function() {
      if (!card.classList.contains('flipped')) {
        card.classList.add('flipped');
        showToast(`Got sticker #${num}!`);
      }
    });
    
    card.addEventListener('touchstart', function(e) {
      if (e.touches.length === 1) {
        // Single tap for flipping
        if (!card.classList.contains('flipped')) {
          card.classList.add('flipped');
          showToast(`Got sticker #${num}!`);
        }
      }
    });

    // Setup touch and drag
    setupTouchEvents(card);
    
    stickerArea.appendChild(card);
    
    // Add to collection
    if (userCollection.includes(num)) {
      if (!duplicates.includes(num)) {
        duplicates.push(num);
        showToast(`Duplicate sticker #${num}!`);
      }
    } else {
      userCollection.push(num);
    }
  });

  // Animate cards spreading out
  setTimeout(() => {
    const cards = document.querySelectorAll('.sticker-card');
    const cardWidth = cards[0].offsetWidth;
    const areaWidth = stickerArea.offsetWidth;
    const spacing = 10;
    
    // Calculate positions for 5 cards
    const totalWidth = (cardWidth * 5) + (spacing * 4);
    let startX = (areaWidth - totalWidth) / 2;
    
    // If cards don't fit, reduce spacing
    if (startX < 10) {
      spacing = 5;
      totalWidth = (cardWidth * 5) + (spacing * 4);
      startX = (areaWidth - totalWidth) / 2;
    }
    
    const yPos = stickerArea.offsetHeight / 2 - cardWidth / 2;
    
    cards.forEach((card, i) => {
      const finalX = startX + i * (cardWidth + spacing);
      const finalY = yPos;
      
      card.style.left = `${finalX}px`;
      card.style.top = `${finalY}px`;
      card.style.transition = 'left 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), top 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)';
    });
  }, 300);
  
  saveGame();
}

// Album and Duplicates Functions
function refreshAlbum() {
  const grid = document.getElementById('album-grid');
  grid.innerHTML = '';
  
  for (let i = 1; i <= STICKERS_TOTAL; i++) {
    const slot = document.createElement('div');
    slot.className = userCollection.includes(i) ? 'slot has-sticker' : 'slot empty';
    
    if (userCollection.includes(i)) {
      const img = document.createElement('img');
      img.src = `images/${i}.png`;
      img.alt = `Sticker #${i}`;
      
      img.onerror = function() {
        this.style.display = 'none';
        const numberDiv = document.createElement('div');
        numberDiv.style.cssText = `
          font-size: 16px;
          color: #4a6fa5;
          font-weight: bold;
          text-align: center;
        `;
        numberDiv.textContent = `#${i}`;
        slot.appendChild(numberDiv);
      };
      
      slot.appendChild(img);
      const numberDiv = document.createElement('div');
      numberDiv.className = 'slot-number';
      numberDiv.textContent = `#${i}`;
      slot.appendChild(numberDiv);
    } else {
      slot.innerHTML = '?';
    }
    
    grid.appendChild(slot);
  }
}

function refreshDuplicates() {
  const grid = document.getElementById('duplicates-grid');
  grid.innerHTML = '';
  
  duplicates.forEach(i => {
    const slot = document.createElement('div');
    slot.className = 'slot has-sticker';
    
    const img = document.createElement('img');
    img.src = `images/${i}.png`;
    img.alt = `Sticker #${i}`;
    
    img.onerror = function() {
      this.style.display = 'none';
      const numberDiv = document.createElement('div');
      numberDiv.style.cssText = `
        font-size: 16px;
        color: #4a6fa5;
        font-weight: bold;
        text-align: center;
      `;
      numberDiv.textContent = `#${i}`;
      slot.appendChild(numberDiv);
    };
    
    slot.appendChild(img);
    const numberDiv = document.createElement('div');
    numberDiv.className = 'slot-number';
    numberDiv.textContent = `#${i}`;
    slot.appendChild(numberDiv);
    
    grid.appendChild(slot);
  });
}

// Event Listeners
document.getElementById('open-pack').addEventListener('click', openPack);
document.getElementById('save-btn').addEventListener('click', saveGame);
document.getElementById('reset-btn').addEventListener('click', resetGame);

document.getElementById('album-btn').addEventListener('click', () => {
  document.getElementById('album-modal').style.display = 'block';
  refreshAlbum();
});

document.getElementById('duplicates-btn').addEventListener('click', () => {
  document.getElementById('duplicates-modal').style.display = 'block';
  refreshDuplicates();
});

document.getElementById('sell-duplicates').addEventListener('click', () => {
  if (duplicates.length === 0) {
    showToast('No duplicates to sell!');
    return;
  }
  
  const earned = duplicates.length;
  coins += earned;
  duplicates.length = 0;
  updateLabels();
  refreshDuplicates();
  saveGame();
  showToast(`Sold duplicates for ${earned} coins!`);
});

// Close modals when clicking outside
document.querySelectorAll('.modal').forEach(modal => {
  modal.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.style.display = 'none';
    }
  });
});

// Load game on startup
function loadGame() {
  const saved = localStorage.getItem("stickerGameSave");
  if (!saved) return;

  try {
    const data = JSON.parse(saved);
    coins = data.coins || 100;
    packsOpened = data.packsOpened || 0;
    userCollection.length = 0;
    duplicates.length = 0;
    if (data.userCollection) userCollection.push(...data.userCollection);
    if (data.duplicates) duplicates.push(...data.duplicates);
    
    updateLabels();
    showToast('Game loaded successfully!');
  } catch (e) {
    console.error('Failed to load game:', e);
    showToast('Failed to load save data');
  }
}

// Initialize
window.addEventListener('DOMContentLoaded', () => {
  loadGame();
  updateLabels();
  
  // Prevent context menu on long press
  stickerArea.addEventListener('contextmenu', (e) => e.preventDefault());
  
  // Handle window resize
  window.addEventListener('resize', updateLabels);
});

// Handle orientation change
window.addEventListener('orientationchange', () => {
  setTimeout(updateLabels, 100);
});
</script>
</body>
</html>